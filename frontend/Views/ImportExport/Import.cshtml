@{
    ViewData["Title"] = "导入联系人";
}

<h2>📥 @ViewData["Title"]</h2>
<hr />

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">上传Excel文件</h5>
            </div>
            <div class="card-body">
                <form asp-action="Import" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                    
                    <div class="mb-3">
                        <label for="file" class="form-label">选择Excel文件 <span class="text-danger">*</span></label>
                        <input type="file" class="form-control" id="file" name="file" accept=".xlsx,.xls" required />
                        <div class="form-text">支持 .xlsx 和 .xls 格式</div>
                    </div>
                    
                    <div class="alert alert-info" role="alert">
                        <h6 class="alert-heading">📋 Excel文件格式要求</h6>
                        <p class="mb-0">Excel文件应包含以下列（按顺序）：</p>
                        <ol class="mb-0 mt-2">
                            <li>姓名（必填）</li>
                            <li>公司</li>
                            <li>职位</li>
                            <li>备注</li>
                            <li>是否收藏（是/否）</li>
                            <li>联系方式类型（手机/电话/邮箱/微信/QQ/地址/其他）</li>
                            <li>联系方式标签</li>
                            <li>联系方式值</li>
                        </ol>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex">
                        <button type="submit" class="btn btn-primary">
                            📤 开始导入
                        </button>
                        <a asp-action="DownloadTemplate" class="btn btn-success">
                            📄 下载导入模板
                        </a>
                        <a asp-controller="Contact" asp-action="Index" class="btn btn-secondary">
                            取消
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">💡 使用提示</h5>
            </div>
            <div class="card-body">
                <ol class="mb-0">
                    <li class="mb-2">下载导入模板</li>
                    <li class="mb-2">按照模板格式填写数据</li>
                    <li class="mb-2">保存为Excel文件</li>
                    <li class="mb-2">上传文件进行导入</li>
                </ol>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">⚠️ 注意事项</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">✓ 姓名为必填项</li>
                    <li class="mb-2">✓ 每个联系人至少需要一个联系方式</li>
                    <li class="mb-2">✓ 同一个联系人的多个联系方式应在连续的行中</li>
                    <li class="mb-2">✓ 导入过程中会自动跳过格式错误的数据</li>
                    <li class="mb-2">✓ 建议先用模板测试小批量数据</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // 文件选择验证
        document.getElementById('file').addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (file) {
                var ext = file.name.split('.').pop().toLowerCase();
                if (ext !== 'xlsx' && ext !== 'xls') {
                    alert('请选择Excel文件（.xlsx 或 .xls）');
                    e.target.value = '';
                    return;
                }
                
                // 显示文件大小
                var size = (file.size / 1024 / 1024).toFixed(2);
                if (size > 10) {
                    alert('文件大小不能超过10MB');
                    e.target.value = '';
                    return;
                }
            }
        });
    </script>
}