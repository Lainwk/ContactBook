@model ContactBook.Web.Models.ViewModels.ContactViewModel

@{
    ViewData["Title"] = "åˆ›å»ºè”ç³»äºº";
}

<h2>@ViewData["Title"]</h2>
<hr />

<div class="row">
    <div class="col-md-8">
        <form asp-action="Create" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            
            @* åŸºæœ¬ä¿¡æ¯ *@
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">åŸºæœ¬ä¿¡æ¯</h5>
                </div>
                <div class="card-body">
                    <div class="form-group mb-3">
                        <label asp-for="Name" class="control-label">å§“å <span class="text-danger">*</span></label>
                        <input asp-for="Name" class="form-control" placeholder="è¯·è¾“å…¥å§“å" />
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label asp-for="Company" class="control-label">å…¬å¸</label>
                        <input asp-for="Company" class="form-control" placeholder="è¯·è¾“å…¥å…¬å¸åç§°" />
                        <span asp-validation-for="Company" class="text-danger"></span>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label asp-for="Position" class="control-label">èŒä½</label>
                        <input asp-for="Position" class="form-control" placeholder="è¯·è¾“å…¥èŒä½" />
                        <span asp-validation-for="Position" class="text-danger"></span>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label asp-for="Notes" class="control-label">å¤‡æ³¨</label>
                        <textarea asp-for="Notes" class="form-control" rows="3" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"></textarea>
                        <span asp-validation-for="Notes" class="text-danger"></span>
                    </div>
                    
                    <div class="form-check">
                        <input asp-for="IsFavorite" class="form-check-input" type="checkbox" />
                        <label asp-for="IsFavorite" class="form-check-label">
                            â­ æ·»åŠ åˆ°æ”¶è—
                        </label>
                    </div>
                </div>
            </div>
            
            @* è”ç³»æ–¹å¼ *@
            <div class="card mb-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">è”ç³»æ–¹å¼</h5>
                    <button type="button" class="btn btn-sm btn-success" id="addContactMethod">
                        â• æ·»åŠ è”ç³»æ–¹å¼
                    </button>
                </div>
                <div class="card-body">
                    <div id="contactMethodsContainer">
                        @for (int i = 0; i < Model.ContactMethods.Count; i++)
                        {
                            <div class="contact-method-item mb-3 p-3 border rounded" data-index="@i">
                                <div class="row">
                                    <div class="col-md-3">
                                        <label class="control-label">ç±»å‹</label>
                                        <select asp-for="ContactMethods[i].Type" class="form-select">
                                            <option value="0">æ‰‹æœº</option>
                                            <option value="1">ç”µè¯</option>
                                            <option value="2">é‚®ç®±</option>
                                            <option value="3">å¾®ä¿¡</option>
                                            <option value="4">QQ</option>
                                            <option value="5">åœ°å€</option>
                                            <option value="6">å…¶ä»–</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="control-label">æ ‡ç­¾</label>
                                        <input asp-for="ContactMethods[i].Label" class="form-control" placeholder="å¦‚ï¼šå·¥ä½œã€ä¸ªäºº" />
                                    </div>
                                    <div class="col-md-5">
                                        <label class="control-label">å€¼</label>
                                        <input asp-for="ContactMethods[i].Value" class="form-control" placeholder="è¯·è¾“å…¥è”ç³»æ–¹å¼" />
                                    </div>
                                    <div class="col-md-1 d-flex align-items-end">
                                        <button type="button" class="btn btn-danger btn-sm remove-contact-method" data-index="@i">
                                            âœ•
                                        </button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            
            @* æ“ä½œæŒ‰é’® *@
            <div class="form-group">
                <button type="submit" class="btn btn-primary">ğŸ’¾ ä¿å­˜</button>
                <a asp-action="Index" class="btn btn-secondary">å–æ¶ˆ</a>
            </div>
        </form>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">ğŸ’¡ æç¤º</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">ğŸ“ å§“åä¸ºå¿…å¡«é¡¹</li>
                    <li class="mb-2">ğŸ“± å¯ä»¥æ·»åŠ å¤šä¸ªè”ç³»æ–¹å¼</li>
                    <li class="mb-2">â­ æ”¶è—çš„è”ç³»äººä¼šæ˜¾ç¤ºåœ¨æ”¶è—åˆ—è¡¨ä¸­</li>
                    <li class="mb-2">ğŸ·ï¸ æ ‡ç­¾å¯ä»¥å¸®åŠ©åŒºåˆ†ä¸åŒç”¨é€”çš„è”ç³»æ–¹å¼</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        var contactMethodIndex = @Model.ContactMethods.Count;
        
        // æ·»åŠ è”ç³»æ–¹å¼
        $('#addContactMethod').click(function() {
            var template = `
                <div class="contact-method-item mb-3 p-3 border rounded" data-index="${contactMethodIndex}">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="control-label">ç±»å‹</label>
                            <select name="ContactMethods[${contactMethodIndex}].Type" class="form-select">
                                <option value="0">æ‰‹æœº</option>
                                <option value="1">ç”µè¯</option>
                                <option value="2">é‚®ç®±</option>
                                <option value="3">å¾®ä¿¡</option>
                                <option value="4">QQ</option>
                                <option value="5">åœ°å€</option>
                                <option value="6">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="control-label">æ ‡ç­¾</label>
                            <input name="ContactMethods[${contactMethodIndex}].Label" class="form-control" placeholder="å¦‚ï¼šå·¥ä½œã€ä¸ªäºº" />
                        </div>
                        <div class="col-md-5">
                            <label class="control-label">å€¼</label>
                            <input name="ContactMethods[${contactMethodIndex}].Value" class="form-control" placeholder="è¯·è¾“å…¥è”ç³»æ–¹å¼" />
                        </div>
                        <div class="col-md-1 d-flex align-items-end">
                            <button type="button" class="btn btn-danger btn-sm remove-contact-method">
                                âœ•
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            $('#contactMethodsContainer').append(template);
            contactMethodIndex++;
        });
        
        // åˆ é™¤è”ç³»æ–¹å¼
        $(document).on('click', '.remove-contact-method', function() {
            if ($('.contact-method-item').length > 1) {
                $(this).closest('.contact-method-item').remove();
            } else {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªè”ç³»æ–¹å¼ï¼');
            }
        });
    </script>
}